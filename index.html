<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" type="text/css" href="http://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="http://stackpath.bootstrapcdn.com/bootswatch/4.1.3/materia/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="http://unpkg.com/formiojs@latest/dist/formio.full.min.css">
  <script type="text/javascript" src="http://unpkg.com/formiojs@latest/dist/formio.full.min.js"></script>

  <style id="compiled-css" type="text/css">
      h1 {
        padding: 40px 0 0 40px
      }
      #formio {
        padding: 20px 40px 40px 40px
      }
  </style>

  <script type="text/javascript">
  var tasksQuery = "query { Tasks(where: {status: {NE: COMPLETED}}) { select { id name assignee priority dueDate status processInstance { businessKey } variables { name value } }}}"  ;

  window.onload=function(){
      var baseUrl = "http://formio.jx-staging.54.159.228.81.nip.io";
      var formPath = "formio-upload";

      fetch('http://activiti-cloud-notifications.jx-staging.54.159.228.81.nip.io/graphql', {
          method: 'post',
          headers: {
            'Content-Type': 'application/json',
            'Auhtorization': 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJoTUJPYnNyb1BJS2JJeTVOUGdnU0pPSGRDcmZFUWlva2otQUIwQjBaS3U0In0.eyJqdGkiOiJhNDlkNjkzNS1mZWRhLTQxYTctYmU1Yi1jMWY0ZWRjZmIwNDUiLCJleHAiOjE1NDc1OTc4OTEsIm5iZiI6MCwiaWF0IjoxNTQ3NTk3NTkxLCJpc3MiOiJodHRwOi8vYWN0aXZpdGkta2V5Y2xvYWsuangtc3RhZ2luZy41NC4xNTkuMjI4LjgxLm5pcC5pby9hdXRoL3JlYWxtcy9hY3Rpdml0aSIsImF1ZCI6ImFjdGl2aXRpIiwic3ViIjoiNWY2ODI5OTktZDExZC00YTQyLWJjNDItODZiN2U2NzViYjc2IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiYWN0aXZpdGkiLCJub25jZSI6Ijk4YzQyZjc2LTViMWUtNGQyYy04YTcwLTRkYmVlODhiZWQzOCIsImF1dGhfdGltZSI6MTU0NzU5NTQ3Mywic2Vzc2lvbl9zdGF0ZSI6ImM1NTdlNzA4LWYzZjItNGJlZi1hODdhLTNkY2VmNjQ2YmNmYyIsImFjciI6IjAiLCJhbGxvd2VkLW9yaWdpbnMiOlsiKiJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsib2ZmbGluZV9hY2Nlc3MiLCJBQ1RJVklUSV9VU0VSIiwiQUNUSVZJVElfQURNSU4iLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJ0ZXN0YWRtaW4gdGVzdGFkbWluIiwicHJlZmVycmVkX3VzZXJuYW1lIjoidGVzdGFkbWluIiwiZ2l2ZW5fbmFtZSI6InRlc3RhZG1pbiIsImZhbWlseV9uYW1lIjoidGVzdGFkbWluIiwiZW1haWwiOiJ0ZXN0YWRtaW5AdGVzdC5jb20ifQ.dTKfU_zbw_cgiQAxigTHtbJpQ22qFrS4pHkKRlRwUa18B3h0cdGk1WyzAmtZiwrhnpqOKYD_SodreFuYg1RD7l0kaNcrWFCWleGCfMTCU5H7Lt3U7DO2NWJdw1i_AFqgYSb9JEOeOYWc64e4J9g6gzxGItXrcAbBfz1aMGtjtXcHP7Qkmup8djWPppXoXXYEqLOxNHwsV9MU690uj-Ll0ijx-EeM2AMEmBCPUUUrA3Lcu0p08SQGUuZfDXcExJR-mf_9155A4nbnzTjSoxQHY5p0neQyeOY0uLsW6fmCwOMq95uH5_bojUGZpOnzkrsfzGGwrhcwShP8U3kp4AHwsg'
          },
          mode: 'cors',
          body: JSON.stringify({
            "query": tasksQuery,
            "variables": null
          })
      }).then(function(response) {
        return response.json();
      }).then(function(json) {
        console.log(json)
      })
    
      fetch(baseUrl+'/user/login', {
          method: 'post',
          headers: {
            'Content-Type': 'application/json'
          },
          mode: 'cors',
          body: JSON.stringify({
            "data": {
              "email": "admin@example.com",
              "password": "password"
            }
          })
        }).then(function(response) {
          Formio.setBaseUrl(baseUrl);
          Formio.setProjectUrl(baseUrl);
          Formio.setToken(response.headers.get('x-jwt-token'));

          Formio.createForm(document.getElementById('formio'), baseUrl+'/'+formPath).then(function(form) {
              form.submission = {
                data: {
                   requestId: 'requestId-'+new Date().getTime(),
                   directiveDate: new Date(),
                   requestor: 'John Dow',
                   amount: 50000,
                   email: 'john@doe.com',
                   subject: 'Trade Request',
                   accountNumber: 12345678
                }
              };

              // What to do when the submit begins.
              form.on('submitDone', function(submission) {
                var submissionId=submission._id;

                // Load submission
                Formio.createForm(document.getElementById('formio'), baseUrl + '/' + formPath + '/submission/' + submissionId, {
                  readOnly: true,
                  viewAsHtml: true
                });
             });
        })
      })
    }
</script>

</head>
<body>
  <h1>IRT Request</h1>
  <div id="formio"></div>
</body>
</html>
